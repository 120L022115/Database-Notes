#### 3-3 数据库实现 - 查询优化

1. 不同策略查询的复杂度有很大差异。
2. 等价转换规则
   1. 关系代数等价：E1三E2
   2. 内外选择串接
   3. 内外选择交换
   4. 内外投影串接
   5. 选择投影交换：条件：选择只有投影的属性
      如果含有其他属性，要再在选择内层再增加一个投影，确保选择能用。
   6. 连接笛卡尔积交换
   7. 集合交换
   8. 连接、笛卡尔积、集合各自的结合律
   9. 选择对连接（笛卡尔积）的分配率
      分配时选择条件要分别对连接两方约束
   10. 投影对连接（笛卡尔积）的分配率
         同上。且投影属性要包含连接属性
   11. 选择（投影）对集合的分配率
   12. 其他
3. 结果大小估计（认为取值是均匀的）
   1. 投影：V(R,A)：A属性集不同值个数
   2. 相等选择：T(R)/V(R,A)
   3. 小于/大于选择：线性分布计算。
   4. 合取选择：T(R) $\Pi_i \frac{s_i}{T(R)}$，Si表示每个合取项的估计值
   5. 析取选择：1-$\Pi$(1-合取项)
   6. 选择$非\theta$：有空值：T(R)-Nnull-N($\theta$)
   7. 笛卡尔积：TS*TR
   8. 自然连接：min{$\frac{n_rn_s}{V(S,A)或V(R,A)}$}
   9. 聚集：V(R,A)
   10. 集合运算
   11. 外连接：自然连接+nr?+ns?
4. 启发式优化规则
   1. 选择投影尽早进行
   2. 选择和笛卡尔积合并为一个连接
   3. 同时执行同关系的选择和投影
   4. 提取公共表达式

5. 算法
   1. 每个选择拆分为单个
   2. 选择投影下放
   3. 组合选择和投影
   4. 重新安排叶节点，让最小选择操作的先执行——选的少了后续连接的也少
   5. 组合笛卡尔积和选择为连接
   6. 划分为多个子树，提取公共表达式和并行运算。
      1. 每个二目运算和树一对一
      2. 尽量把一目运算放到子树中


