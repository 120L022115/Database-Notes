#### 3-2 数据库实现 - 查询处理

1. 查询过程
   SQL$\overset{分析器}{\to}$语法树$\overset{翻译器}{\to}$**逻辑树**（要会画）$\overset{优化器}{\to}$物理树$\overset{执行器}{\to}$查询结果
2. 三种树见PPT
3. 关系代数操作算法
   1. 选择
   2. 投影
   3. 连接 —— 自然连接
   4. 集合 —— 并集、差集
4. 选择算法
   1. 简单选择：线性搜索，二元搜索（有排序，二分查找，O(nlogn)），HASH搜索，主索引搜索，聚集索引搜索，B+树搜索。
   2. 复杂选择：合取选择（每个条件按照简单搜索一遍），复合索引选择（存在所有搜索属性的索引）
5. 投影算法：每个元组过滤一遍，如果投影结果相同，**需要去重**
6. 连接算法
   1. 基本符号：
      1. T(R)：关系R的元组数
      2. B(R)：关系R的块数
      3. M：最大可用内存页数
      4. V(R,AB)：关系R的属性AB不同元组的个数：COUNT(DISTINCT AB)
      5. S,R两个关系，默认B(S)<B(R)
   2. 一趟连接：读入小的全部，再读大的一块一块连。
      IO: B(R)+B(S)，M$\ge$B(S)+1
   3. 元组嵌套循环链接：二重循环，小的放外面，一个一个元组连接。
      IO: T(S)(T(R)+1)， M$\ge$2
   4. 块嵌套循环连接：先读入M-1块S，再一块一块读R。
      IO：B(S)+$\frac{B(S)B(R)}{M-1}$，M$\ge$2
   5. 排序归并连接：每个关系都划分为最大的归并段，然后读入每个归并段的前n页连接。
      IO：3(BS+BR)，BR+BS<$M^2$
   6. 哈希连接：留一页用来读，M-1个哈希桶分桶；然后用一趟链接对每个**同号桶**连接
      不同号的桶一定不能连接（以连接键作为哈希键）
      IO：3(BS+BR)，BS<$(M-1)^2$
   7. 索引连接：R读入每一块，每个元组查S的索引。Y是连接键也是索引键
      聚集索引：BR+$\frac{T(R)T(S)}{V(S,Y)}$
      非聚集索引：BR+TR(BS/V(S,AB))
      M$\ge$2
7. 集合操作算法：相同键排序、然后完成操作。